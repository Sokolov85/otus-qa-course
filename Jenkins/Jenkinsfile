pipeline {
    agent {
        docker { image 'otus-qa' }
    }
    environment {
        JAVA_HOME = "usr/lib/jvm/java-1.8-openjdk"
        PATH    = "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/jvm/java-1.8-openjdk:/usr/lib/jvm/java-1.8-openjdk"
    }
    stages {
        stage('Test') {
            steps {
                sh 'python --version'
                sh 'pytest --url=http://demo23.opencart.pro/admin --browser_type=chrome --window_option=headless lesson_27/test_lesson_27.py'
                sh 'pytest lesson_18/test_lesson_18.py --url=http://demo23.opencart.pro/admin --browser_type=chrome --capture=no --verbose --alluredir=report'
            }
        }
    }
    post{
        always {
            allure([
                includeProperties: true,
                jdk              : '',
                properties       : [],
                reportBuildPolicy: 'ALWAYS',
                results          : [[path: 'report_build']]
            ])
        }
    }
}